<!DOCTYPE html>
<html>
<head>
	<title>POC</title>
</head>
<body>
<body>
<div class="container-fluid">
  	<div class="row-fluid mt-5">
  		<div class="col-12 " >
  			<h2>
  				IBAN POC
  			</h2>
  		</div>
  		<div class="col-12" id="alerts">
			<div class="alert alert-warning alert-dismissible fade show" role="alert" >
	 
			</div>  			
  		</div>
		<div class="col-12">
			<form id="form">
			  <div class="form-row">
			    <div class="col-6">
			      	<input type="text" class="form-control" placeholder="IBAN" id="iban">
			    </div>
			    <div class="col-3">
			        <input type="number" min="1" max="10000" class="form-control" placeholder="Amount" value="1" id="amount">
			    </div>
			    <div class="col-3">
			        <button type="button" class="form-control" disabled="true" id="submitForm">Submit</button>
			    </div>			    
			  </div>
			</form>
		</div>  		
  	</div>
</div>
<style type="text/css">
	.has-danger .form-control {
    	border-color: #d9534f;
	}
</style>
<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css" >
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="bootstrap/dist/js/bootstrap.min.js" ></script>
<script type="module">
import { debouncer, isIBAN, isNumber, handleErrors, showErrors, isFormValid } from '/app/js/helper.js'

let submitButton = document.querySelector('#submitForm')
let ibanInput = document.querySelector("#iban")

let validationSchema = {
	iban: {
		required:  true,
		minLength: 3
	},
	amount: {
		required:  true,
		minLength: 0
	}	 
}

ibanInput.addEventListener( "keyup" , debouncer( ( e ) => { 
	handleErrors( ibanInput, isIBAN( ibanInput.value ) )
	showErrors( document.querySelector("#alerts") )
	let isValid = isFormValid( "#form", validationSchema )
	isValid ? submitButton.removeAttribute('disabled') : submitButton.setAttribute('disabled', true)
} , 1000  ) )

let amountInput = document.querySelector("#amount")
amountInput.addEventListener( "keyup" , debouncer( ( e ) => { 
	handleErrors( amountInput, isNumber( amountInput.value ) ) 
	showErrors( document.querySelector("#alerts") ) 
	let isValid = isFormValid( "#form", validationSchema ) 
	isValid ? submitButton.removeAttribute('disabled') : submitButton.setAttribute('disabled', true)
} , 1000  ) )

submitButton.addEventListener("click", ( e ) => {
	e.preventDefault()
	console.log( ibanInput.value, " and ", amountInput.value, " submitted")
})

</script>
</body>
</html>